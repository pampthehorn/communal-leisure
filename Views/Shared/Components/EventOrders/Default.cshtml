@using website.Models
@model EventOrdersViewModel

<div class="event-attendee-list" style="margin-top: 40px;">
    <h2>Attendee List 📋</h2>
    <p>All completed ticket sales for <strong>@Model.EventName</strong>.</p>
    <hr />

    @if (!Model.CompletedOrders.Any())
    {
    }
    else
    {
        <p>
            <strong>Total Orders:</strong> @Model.CompletedOrders.Count()
            <br />
            <strong>Total Tickets Sold:</strong> @Model.CompletedOrders.SelectMany(ovm => ovm.Tickets).Sum(t => t.Quantity)
        </p>

        <table class="table table-striped table-hover" style="width: 100%; border: 1px solid #ddd;">
            <thead style="background-color: #f5f5f5;">
                <tr>
                    <th style="padding: 12px;">Order #</th>
                    <th style="padding: 12px;">Customer Name</th>
                    <th style="padding: 12px;">Customer Email</th>
                    <th style="padding: 12px;">Tickets Purchased</th>
                    <th style="padding: 12px;">Purchase Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var orderVm in Model.CompletedOrders)
                {
                    <tr>
                        <td style="padding: 12px; vertical-align: top;">@orderVm.Order.Id</td>
                        <td style="padding: 12px; vertical-align: top;">@orderVm.Order.CustomerName</td>
                        <td style="padding: 12px; vertical-align: top;">@orderVm.Order.CustomerEmail</td>

                        <td style="padding: 12px; vertical-align: top;">
                            <ul style="margin: 0; padding-left: 20px; list-style-type: none;">
                                @foreach (var ticket in orderVm.Tickets)
                                {
                                    <li>
                                        <strong>@ticket.Quantity</strong> x @ticket.Type

                                        @if (!string.IsNullOrEmpty(ticket.TicketCodes))
                                        {
                                            var codes = ticket.TicketCodes.Split(',');
                                            <ul style="font-size: 0.9em; font-family: 'Courier New', monospace; padding-left: 25px; list-style-type: square; margin-top: 5px;">
                                                @foreach (var code in codes)
                                                {
                                                    <li>@code</li>
                                                }
                                            </ul>
                                        }
                                    </li>
                                }
                            </ul>
                        </td>
                        <td style="padding: 12px; vertical-align: top;">@orderVm.Order.CreatedDate.ToString("dd/MM/yy HH:mm")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>