@using Umbraco.Cms.Web.Common.PublishedModels
@using website.Controllers
@using website.Models
@using website.Models.ViewModels
@using Microsoft.Extensions.Options
@using Umbraco.Cms.Core.Configuration.Models

@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage

@inject IOptions<SecuritySettings> SecuritySettings

@{
    Layout = "_Layout.cshtml";
    
    var token = Context.Request.Query["token"].ToString();
    var email = Context.Request.Query["email"].ToString();
    
    var pwSettings = SecuritySettings.Value.MemberPassword;
}

<h2>Reset Your Password</h2>

@if (string.IsNullOrEmpty(token) || string.IsNullOrEmpty(email))
{
    <p class="text-danger">The password reset link is invalid or has expired.</p>
}
else
{
    @using (Html.BeginUmbracoForm<MemberPasswordSurfaceController>("HandleResetPassword", FormMethod.Post))
    {

        <small id="pw-help" class="form-text text-muted">
            Your password must:
            <ul>
                <li>At least @pwSettings.RequiredLength characters long.</li>
                @if (pwSettings.RequireDigit)
                {
                    <li>contain at least one number (0-9).</li>
                }
                @if (pwSettings.RequireLowercase)
                {
                    <li>contain at least one lowercase letter (a-z).</li>
                }
                @if (pwSettings.RequireUppercase)
                {
                    <li>contain at least one uppercase letter (A-Z).</li>
                }
                @if (pwSettings.RequireNonLetterOrDigit)
                {
                    <li>contain at least one special character (e.g., !@@#$).</li>
                }
            </ul>
        </small>

        @Html.ValidationSummary(false, "", new { @class = "text-danger" })
        
        @Html.Hidden("Token", token)
        @Html.Hidden("Email", email)

        <div class="form-group">
            @Html.Label("Password", "New Password")
            @Html.Password("Password", null, new { @class = "form-control", aria_describedby = "pw-help" })
            @Html.ValidationMessage("Password", "", new { @class = "text-danger" })
            

        </div>

        <div class="form-group">
            @Html.Label("ConfirmPassword", "Confirm New Password")
            @Html.Password("ConfirmPassword", null, new { @class = "form-control" })
            @Html.ValidationMessage("ConfirmPassword", "", new { @class = "text-danger" })
        </div>

        <button type="submit" class="btn btn-primary">Reset Password</button>
    }
}